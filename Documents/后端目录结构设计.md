# Telegram 聊天系统 - 后端目录结构设计 (v2.0)

## 1. 项目整体架构

本项目放弃传统的 MVC 分层（Controller/Service/Dao 混在一起），采用 **Spring Modulith (模块化单体)** 架构。这种结构能清晰地界定业务边界，防止代码变成“大泥球”，并且天然支持未来拆分为微服务。

### 1.1 模块化设计图

```text
┌─────────────────────────────────────────────────────────┐
│                   Spring Boot Host                      │
│ ┌────────────┐  ┌────────────┐  ┌────────────────────┐  │
│ │ Auth Module│  │ User Module│  │ Chat Module (Core) │  │
│ └──────┬─────┘  └──────┬─────┘  └──────────┬─────────┘  │
│        │               │                   │            │
└────────┼───────────────┼───────────────────┼────────────┘
         ▼               ▼                   ▼
┌─────────────────────────────────────────────────────────┐
│               Infrastructure Module (Shared)            │
│  (Redis / Security / Snowflake ID / Global Exceptions)  │
└─────────────────────────────────────────────────────────┘
```

## 2. 目录结构说明

### 2.1 详细目录树

src/main/java/com/example/telegram/
├── TelegramApplication.java              # 启动类
│
├── infrastructure/                       # [基础设施层]：所有模块通用的底座
│   ├── config/                           # 全局配置 (VirtualThreads, Redis, OpenAPI)
│   ├── security/                         # JWT, Spring Security 过滤器
│   ├── web/                              # 全局异常处理, Result `<T>` 包装类
│   └── util/                             # 雪花算法ID生成器, JSON工具
│
├── auth/                                 # [认证模块]
│   ├── AuthController.java               # 登录/注册接口
│   ├── AuthService.java                  # 令牌签发逻辑
│   └── dto/                              # 登录请求/响应对象
│
├── user/                                 # [用户模块]
│   ├── UserController.java               # 个人信息/好友管理
│   ├── UserService.java
│   ├── User.java                         # 实体类 (JPA)
│   └── UserRepository.java               # 数据库访问
│
└── chat/                                 # [聊天核心模块]
    ├── controller/                       # 历史消息查询, 文件上传
    ├── socket/                           # WebSocket Endpoint (STOMP/Native)
    ├── service/                          # 消息路由, 状态同步
    ├── model/                            # Message 实体, 会话模型
    └── repository/                       # 消息持久化

### 2.2 核心资源文件结构

src/main/resources/
├── application.yml                       # 主配置文件
├── application-dev.yml                   # 开发环境配置
├── application-prod.yml                  # 生产环境配置
├── db/migration/                         # Flyway 数据库版本管理
│   ├── V1__init_schema.sql               # 初始化表结构
│   └── V2__add_indexes.sql               # 索引优化
└── static/                               # 静态资源 (可选)

### 2.3 关键依赖说明

org.springframework.modulith:spring-modulith-starter-core: 用于模块化治理。
org.springframework.boot:spring-boot-starter-data-jpa: 核心 ORM，替代 MyBatis。
org.springframework.boot:spring-boot-starter-data-redis: 必须，用于分布式会话和缓存。
org.springframework.boot:spring-boot-starter-websocket: 实时通讯基座。
org.flywaydb:flyway-core: 数据库表结构自动同步工具。

### 2.4 核心文件配置策略

Virtual Threads: spring.threads.virtual.enabled=true (利用 Java 21 高并发优势)。
JPA: spring.jpa.hibernate.ddl-auto=validate (生产环境禁止自动 update，交由 Flyway 管理)。
ID Strategy: 禁用数据库自增 ID，全系统使用应用层生成的雪花 ID。
