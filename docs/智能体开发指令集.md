# 智能体开发指令集
本指令集主要是为了指导智能体在开发过程中遵循最佳实践和规范，确保代码质量和项目结构的合理性。请严格按照以下指令执行：
## 架构与规范
- 架构模式: 严格遵循 Spring Modulith，模块间（auth, user, chat）保持边界清晰，禁止循环依赖。
- 基础设施: 所有通用逻辑（ID生成、异常处理、Redis配置）必须下沉至 infrastructure 模块。
- ID 策略: 严禁使用数据库自增 ID。所有实体（User, Message）必须使用 infrastructure 模块提供的 雪花算法 (Snowflake) 生成 ID
- 并发模型: 充分利用 Java 21 虚拟线程 (spring.threads.virtual.enabled=true) 处理高并发 I/O。
## 核心业务逻辑
- 消息路由: 必须实现 Redis Pub/Sub 机制。消息流程为：WebSocket接收 -> 持久化(MySQL) -> Redis广播 -> 目标服务器监听 -> 推送给用户。
- 未读计数: 必须使用 Redis Atomic Integer (chat:unread:{userId}:{senderId})，严禁频繁 count(*) 数据库。
- 数据持久化: 必须使用 Spring Data JPA，禁止手写原生 SQL（除非极特殊性能场景），禁止使用 MyBatis。
## 接口与协议
- REST API: 统一返回 Result<T> 格式，路径遵循 /api/v1/...。
- WebSocket: 端点固定为 /ws-chat，订阅路径 /user/{userId}/queue/messages。
- 文档注释: 所有代码注释必须使用简体中文。
## 前端协同
- 技术栈：Vue3(Composition API) + Pinia + TypeScript。
- 离线优先: 关键聊天数据需考虑 IndexedDB 本地存储。